import { useTemplate } from '@/utils/template'
import { uid } from 'uid'

// Not all statuses are used in the UI, but they are defined here for completeness
export const flagLabels = [
  'component_not_present',
  'inline_mitigations_already_exist',
  'vulnerable_code_cannot_be_controlled_by_adversary',
  'vulnerable_code_not_in_execute_path',
  'vulnerable_code_not_present',
] as const

export type TVulnerabilityFlagLabel = (typeof flagLabels)[number]

export type TVulnerabilityFlag = {
  id: string
  label: TVulnerabilityFlagLabel
  productIds: string[]
}

export function useVulnerabilityFlagGenerator() {
  const { getTemplateDefaultObject } = useTemplate()
  const defaultProduct = getTemplateDefaultObject<TVulnerabilityFlag>(
    'vulnerabilities.flags',
  )

  const generateVulnerabilityFlag = (): TVulnerabilityFlag => {
    return {
      id: uid(),
      productIds: defaultProduct.productIds || [],
      label: defaultProduct.label || 'component_not_present',
    }
  }

  return {
    generateVulnerabilityFlag,
  }
}
